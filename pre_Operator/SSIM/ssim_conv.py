import numpy as np

# 输入数据：10 行 × 22 列
input_data = np.array([
    [65, 14, 167, 209, 167, 14, 65, 104, 184, 147, 153, 137, 130, 135, 70, 114, 118, 88, 38, 88, 118, 114],
    [226, 189, 49, 180, 49, 189, 226, 245, 194, 214, 123, 238, 107, 190, 253, 59, 150, 183, 59, 183, 150, 59],
    [211, 240, 58, 0, 58, 240, 211, 112, 192, 170, 81, 49, 209, 239, 238, 189, 239, 239, 17, 239, 239, 189],
    [171, 66, 196, 84, 196, 66, 171, 46, 196, 5, 244, 134, 43, 148, 67, 15, 208, 216, 185, 216, 208, 15],
    [211, 240, 58, 0, 58, 240, 211, 112, 192, 170, 81, 49, 209, 239, 238, 189, 239, 239, 17, 239, 239, 189],
    [226, 189, 49, 180, 49, 189, 226, 245, 194, 214, 123, 238, 107, 190, 253, 59, 150, 183, 59, 183, 150, 59],
    [65, 14, 167, 209, 167, 14, 65, 104, 184, 147, 153, 137, 130, 135, 70, 114, 118, 88, 38, 88, 118, 114],
    [156, 8, 21, 167, 21, 8, 156, 215, 222, 23, 197, 73, 214, 195, 132, 108, 122, 191, 61, 191, 122, 108],
    [137, 127, 205, 33, 205, 127, 137, 134, 18, 34, 15, 148, 169, 86, 6, 31, 174, 44, 198, 44, 174, 31],
    [154, 98, 52, 195, 52, 98, 154, 19, 122, 96, 92, 80, 35, 225, 188, 157, 160, 250, 190, 250, 160, 157]
], dtype=np.float32)

# 卷积核：7x7，全为 1/49
kernel = np.ones((7, 7), dtype=np.float32) / 49.0

# 手动实现 valid 卷积（无填充，步长=1）
def conv2d_valid(input_mat, kernel):
    h, w = input_mat.shape
    kh, kw = kernel.shape
    out_h = h - kh + 1
    out_w = w - kw + 1
    output = np.zeros((out_h, out_w), dtype=np.float32)

    for i in range(out_h):
        for j in range(out_w):
            region = input_mat[i:i+kh, j:j+kw]
            output[i, j] = np.sum(region * kernel)

    return output

# 计算卷积结果
result = conv2d_valid(input_data, kernel)

# 打印结果（保留6位小数）
print("卷积结果（4×16）：")
np.set_printoptions(precision=6, suppress=True)
print(result)
